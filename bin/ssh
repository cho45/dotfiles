#!/bin/sh

HOST=$(hostname)
if [ -e $HOME/.keychain/$HOST-sh ]; then
	. $HOME/.keychain/$HOST-sh
fi

ssh-add -l > /dev/null 2>&1

if [ $? -ne 0 ]; then
	keychain --quiet --stop all
	keychain --quiet --timeout 30 $HOME/.ssh/id_dsa
	if [ $? -eq 0 ]; then
		. $HOME/.keychain/*-sh
	else
		exit 1
	fi
fi

COMMAND=${0##*/}
COMMAND=`which -a $COMMAND | grep -v $0 | head -n 1`

/usr/bin/env $COMMAND ${@+"$@"}

