# git-date-remap

Git のコミット履歴の期間を、別の期間に線形に再配置（リマップ）するツールです。
内部で `git-filter-repo` を使用し、外科手術的（Surgical）に現在のブランチの履歴のみを書き換えます。

## 特徴

1.  **歴史の保護**: 指定された開始時刻より前のコミットは一切変更されません。コールバックの早期リターンにより、古いコミットのハッシュ値は完全に維持されます。
2.  **線形リマップ**: 指定された期間内のコミットを、新しい期間にぴったり収まるように投影します。
3.  **安全な設計**: `--refs HEAD` および `--partial` オプションを使用するため、現在のブランチ以外の参照（他のブランチ、タグ、リモート設定など）は一切変更・削除されません。

## 使い方

```bash
./git-date-remap.py <変換元> <変換後> [オプション]
```

### 引数

- **変換元 (Source)**: 書き換えの起点となる時刻、または Git のリビジョン範囲。
    - 時刻指定（例: `2023-01-01`, `09:00`）: その時刻から最新コミットまでが対象。
    - リビジョン範囲（例: `HEAD~10..HEAD`）: その範囲内の最古から最新までを基準に計算。
- **変換後 (Dest)**: 投影先の時間範囲。
    - `開始時刻..終了時刻`（例: `2025-01-01..2025-01-02`）
    - `開始時刻..` または `開始時刻` のみ: 終了時刻に「現在時刻」が自動的に使用されます。
    - タイムゾーン（例: `+0900`）が含まれる場合は、対象コミットのタイムゾーンも一括変更されます。含まれない場合は各コミットの元のタイムゾーンが維持されます。

### オプション

- `-f`, `--force`: 確認プロンプトを表示せずに実行します。
- `-n`, `--dry-run`: 変更内容のプレビューを表示して終了します。

## 使用例

### 例1: 特定の時刻以降の活動を、2025年元旦から現在までにリマップする
```bash
./git-date-remap.py 2023-01-01 2025-01-01..
```

### 例2: 今日の午前中の活動を、午後にリマップする
```bash
./git-date-remap.py 09:00 13:00..
```

## 推奨される安全な運用方法

1. **作業用コピーの作成**
   ```bash
   cp -r my-repo my-repo-rewrite && cd my-repo-rewrite
   ```

2. **リマップの実行と確認**
   ```bash
   ./git-date-remap.py 2023-01-01 2025-01-01..
   git log --graph --oneline --format="%h %ai %s"
   ```

3. **リモートへの適用**
   すでにプッシュ済みの歴史を書き換えた場合は、強制プッシュが必要です（未プッシュなら通常の push で構いません）。
   ```bash
   git push origin HEAD --force
   ```

4. **元レポジトリの同期**
   歴史（ハッシュ値）が書き換わっているため、元のディレクトリでは `git pull` は使えません。リモート（または作業用コピー）から強制的に同期します。
   ```bash
   cd ../my-repo
   git fetch origin && git reset --hard origin/$(git branch --show-current)
   ```

## 注意事項

- **ハッシュの変化**: 対象期間内のコミット日時が変わるため、それ以降のコミットハッシュはすべて新しくなります。
- **依存ツール**: `git-filter-repo` がインストールされている必要があります。

## ライセンス

MIT